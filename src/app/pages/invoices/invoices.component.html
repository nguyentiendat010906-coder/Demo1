<div class="invoices-page">
  <h2 class="title">Danh s√°ch h√≥a ƒë∆°n</h2>

  <div *ngIf="invoices.length === 0" class="empty-state">
    Ch∆∞a c√≥ h√≥a ƒë∆°n n√†o
  </div>

  <table class="invoice-table" *ngIf="invoices.length > 0">
    <thead>
      <tr>
        <th>M√£</th>
        <th>B√†n</th>
        <th>Ng√†y</th>
        <th>Tr·∫°ng th√°i</th>
        <th>T·ªïng ti·ªÅn</th>
        <th></th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let invoice of invoices">
        <td><strong>#{{ invoice.id }}</strong></td>
        <td>{{ invoice.tableName }}</td>
        <td>{{ invoice.invoiceDate | date:'dd/MM/yyyy' }}</td>
        <td>
          <span class="status" [ngClass]="{
            'status-paid': invoice.status === 'paid',
            'status-open': invoice.status !== 'paid'
          }">
            {{ invoice.status === 'paid' ? 'ƒê√£ thanh to√°n' : 'Ch∆∞a thanh to√°n' }}
          </span>
        </td>
        <td><strong>{{ invoice.totalAmount | number:'1.0-0' }} ƒë</strong></td>
        <td>
          <button class="btn-view" (click)="viewDetail(invoice.id)">
            üëÅÔ∏è Xem
          </button>
        </td>
      </tr>
    </tbody>
  </table>
</div>

<!-- MODAL CHI TI·∫æT -->
<div class="modal-backdrop" *ngIf="selectedInvoice" (click)="closeModal()">
  <div class="modal" (click)="$event.stopPropagation()">
    
    <div class="modal-header">
      <h3>Chi ti·∫øt h√≥a ƒë∆°n #{{ selectedInvoice.id }}</h3>
      <button class="btn-close" (click)="closeModal()">‚úñ</button>
    </div>

    <div class="modal-body">
      <div class="info-grid">
        <div class="info-item">
          <span class="label">B√†n:</span>
          <span class="value">{{ selectedInvoice.tableName }}</span>
        </div>

        <div class="info-item">
          <span class="label">Nh√≥m:</span>
          <span class="value">{{ selectedInvoice.groupName }}</span>
        </div>

        <div class="info-item">
          <span class="label">Thu ng√¢n:</span>
          <span class="value">{{ selectedInvoice.cashierName }}</span>
        </div>

        <div class="info-item">
          <span class="label">Ng√†y:</span>
          <span class="value">
            {{ selectedInvoice.invoiceDate | date:'dd/MM/yyyy' }}
          </span>
        </div>

        <div class="info-item">
          <span class="label">Gi·ªù b·∫Øt ƒë·∫ßu:</span>
          <span class="value">
            {{ selectedInvoice.invoiceDate | date:'HH:mm' }}
          </span>
        </div>

        <div class="info-item">
          <span class="label">Gi·ªù k·∫øt th√∫c:</span>
          <span class="value">
            {{ selectedInvoice.endTime ? (selectedInvoice.endTime | date:'HH:mm') : '‚Äî' }}
          </span>
        </div>

        <div class="info-item">
          <span class="label">Th·ªùi gian ph·ª•c v·ª•:</span>
          <span class="value">
            {{ formatServiceTime(selectedInvoice.serviceHours) }}
          </span>
        </div>

        <div class="info-item">
          <span class="label">Tr·∫°ng th√°i:</span>
          <span class="status"
            [ngClass]="{
              'status-paid': selectedInvoice.status === 'paid',
              'status-open': selectedInvoice.status !== 'paid'
            }">
            {{ selectedInvoice.status === 'paid' ? 'ƒê√£ thanh to√°n' : 'Ch∆∞a thanh to√°n' }}
          </span>
        </div>
      </div>

      <h4>Chi ti·∫øt m√≥n</h4>
      <table class="detail-table" *ngIf="selectedInvoice.invoiceDetails?.length">
        <thead>
          <tr>
            <th>S·∫£n ph·∫©m</th>
            <th>SL</th>
            <th>ƒê∆°n gi√°</th>
            <th>Th√†nh ti·ªÅn</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let item of selectedInvoice.invoiceDetails">
            <td>{{ item.productName }}</td>
            <td>{{ item.quantity }}</td>
            <td>{{ item.unitPrice | number:'1.0-0' }} ƒë</td>
            <td><strong>{{ item.quantity * item.unitPrice | number:'1.0-0' }} ƒë</strong></td>
          </tr>
        </tbody>
      </table>

      <div *ngIf="!selectedInvoice.invoiceDetails || selectedInvoice.invoiceDetails.length === 0" 
           class="empty-state-items">
        Kh√¥ng c√≥ m√≥n n√†o
      </div>

      <div class="total-section">
        <div class="total-row">
          <span>T·∫°m t√≠nh</span>
          <span>{{ selectedInvoice.subtotal | number:'1.0-0' }} ƒë</span>
        </div>
        <div class="total-row">
          <span>VAT (10%)</span>
          <span>{{ selectedInvoice.vatAmount | number:'1.0-0' }} ƒë</span>
        </div>
        <div class="total-row total-final">
          <strong>T·ªïng ti·ªÅn</strong>
          <strong class="total-amount">{{ selectedInvoice.totalAmount | number:'1.0-0' }} ƒë</strong>
        </div>
      </div>
    </div>
  </div>
</div>
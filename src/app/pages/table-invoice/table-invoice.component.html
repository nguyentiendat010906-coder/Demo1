<div class="pos-layout">

  <!-- ===================== MENU PANEL ===================== -->
  <div class="menu-panel">
    <h3 class="panel-title">Danh sÃ¡ch sáº£n pháº©m</h3>
    
    <!-- FILTER CONTROLS -->
    <div class="menu-filters">
      <!-- Search -->
      <div class="filter-search">
        <span class="search-icon">ğŸ”</span>
        <input 
          type="text" 
          [(ngModel)]="searchText" 
          (ngModelChange)="onSearchChange()"
          placeholder="QuÃ©t mÃ£ váº¡ch hoáº·c tÃ¬m tÃªn sáº£n pháº©m...">
      </div>
      
      <!-- Category Tabs -->
      <div class="filter-tabs">
        <button 
          class="filter-tab"
          [class.active]="selectedCategory === 'all'"
          (click)="selectedCategory = 'all'; onCategoryChange()">
          ğŸ½ï¸ Táº¥t cáº£
        </button>
        <button 
          *ngFor="let cat of categories"
          [hidden]="cat === 'all'"
          class="filter-tab"
          [class.active]="selectedCategory === cat"
          (click)="selectedCategory = cat; onCategoryChange()">
          {{ cat === 'Báº¿p' ? 'ğŸ³' : cat === 'Bar' ? 'ğŸ¹' : 'ğŸ“¦' }} {{ cat }}
        </button>
      </div>
    </div>
    
    <!-- MENU LIST -->
    <div class="menu-list">
      <div class="menu-item"
           *ngFor="let m of filteredMenu"
           (click)="addItem(m)">
        <div class="menu-item-image">
          {{ m.category === 'Báº¿p' ? 'ğŸ³' : m.category === 'Bar' ? 'ğŸ¹' : 'ğŸ“¦' }}
          <span class="menu-item-stock">x{{ m.stock || 15 }}</span>
        </div>
        <div class="menu-item-info">
          <div class="menu-name">{{ m.name }}</div>
          <div class="menu-price">{{ m.price | number }}Ä‘</div>
        </div>
      </div>
      
      <!-- Empty state -->
      <div *ngIf="filteredMenu.length === 0" class="menu-empty" style="grid-column: 1/-1;">
        <p>âŒ KhÃ´ng tÃ¬m tháº¥y sáº£n pháº©m nÃ o</p>
      </div>
    </div>
  </div>

  <!-- ===================== INVOICE PANEL ===================== -->
  <div class="invoice-panel">

    <!-- HEADER -->
    <div class="invoice-header">
      <div class="header-left">
        <h3>{{ tableName || 'ÄÆ¡n hÃ ng #' + tableId }}</h3>
        <div>â° Giá» vÃ o: {{ startTime | date:'HH:mm dd/MM/yyyy' }}</div>
        <div>ğŸ‘¤ Thu ngÃ¢n: <b>{{ cashier }}</b></div>
      </div>

      <div class="header-right">
        <div class="time">
          <div>â±ï¸ Phá»¥c vá»¥: {{ serviceMinutes }} phÃºt</div>
        </div>
        <div class="grand-total">
          {{ total | number }}Ä‘
        </div>
      </div>
    </div>

    <!-- CUSTOMER INFO -->
    <div class="customer-info">
      <div class="customer-display">
        <h4>ğŸ‘¤ ThÃ´ng tin khÃ¡ch hÃ ng</h4>
        <div class="customer-details" *ngIf="customerName || customerPhone">
          <span><strong>{{ customerName || 'KhÃ¡ch láº»' }}</strong></span>
          <span *ngIf="customerPhone">ğŸ“ {{ customerPhone }}</span>
        </div>
        <div class="customer-details" *ngIf="!customerName && !customerPhone">
          <span class="empty">ChÆ°a cÃ³ thÃ´ng tin khÃ¡ch hÃ ng</span>
        </div>
      </div>
      <button class="add-customer-btn" (click)="openCustomerModal()">
        {{ customerName ? 'âœï¸ Sá»­a' : 'â• ThÃªm' }}
      </button>
    </div>

    <!-- ITEMS -->
    <div class="invoice-items">
      <div class="item-row" *ngFor="let i of items">
        <div class="item-name">{{ i.productName }}</div>

        <div class="qty-control">
          <button (click)="decrease(i)">âˆ’</button>
          <span class="qty">{{ i.quantity }}</span>
          <button (click)="increase(i)">+</button>
        </div>

        <div class="item-price">
          {{ i.unitPrice * i.quantity | number }}Ä‘
        </div>

        <button class="remove" (click)="remove(i)">âœ•</button>
      </div>
    </div>

    <!-- SUMMARY -->
    <div class="summary">
      <div class="line">
        <span>Táº¡m tÃ­nh</span>
        <span>{{ subTotal | number }}Ä‘</span>
      </div>
      <div class="line">
        <span>VAT (10%)</span>
        <span>{{ vat | number }}Ä‘</span>
      </div>
      <div class="line total">
        <b>Tá»•ng thanh toÃ¡n</b>
        <b>{{ total | number }}Ä‘</b>
      </div>

      <button class="pay" [disabled]="items.length === 0" (click)="saveInvoice()">
        Thanh toÃ¡n
      </button>
    </div>

  </div>
</div>

<!-- ===================== CUSTOMER MODAL ===================== -->
<div class="modal-overlay" *ngIf="showCustomerModal" (click)="closeCustomerModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    
    <!-- Modal Header -->
    <div class="modal-header">
      <h3>ğŸ‘¤ ThÃ´ng tin khÃ¡ch hÃ ng</h3>
      <button class="modal-close" (click)="closeCustomerModal()">âœ•</button>
    </div>
    
    <!-- Modal Body -->
    <div class="modal-body">
      <form class="modal-form">
        
        <!-- Row 1: Há» tÃªn & Sá»‘ Ä‘iá»‡n thoáº¡i -->
        <div class="form-row">
          <div class="form-field">
            <label>
              Há» vÃ  tÃªn <span class="required">*</span>
            </label>
            <input 
              type="text" 
              [(ngModel)]="customerName"
              name="customerName"
              placeholder="Nháº­p há» vÃ  tÃªn..."
              required>
          </div>
          
          <div class="form-field">
            <label>
              Sá»‘ Ä‘iá»‡n thoáº¡i <span class="required">*</span>
            </label>
            <input 
              type="tel" 
              [(ngModel)]="customerPhone"
              name="customerPhone"
              placeholder="Nháº­p sá»‘ Ä‘iá»‡n thoáº¡i..."
              required>
          </div>
        </div>
        
        <!-- Row 2: MÃ£ sá»‘ thuáº¿ & Sá»‘ CCCD -->
        <div class="form-row">
          <div class="form-field">
            <label>MÃ£ sá»‘ thuáº¿</label>
            <input 
              type="text" 
              [(ngModel)]="customerTaxCode"
              name="customerTaxCode"
              placeholder="Nháº­p mÃ£ sá»‘ thuáº¿...">
          </div>
          
          <div class="form-field">
            <label>Sá»‘ CCCD/CMND</label>
            <input 
              type="text" 
              [(ngModel)]="customerIdCard"
              name="customerIdCard"
              placeholder="Nháº­p sá»‘ CCCD/CMND...">
          </div>
        </div>
        
        <!-- Row 3: Email -->
        <div class="form-field full-width">
          <label>Email</label>
          <input 
            type="email" 
            [(ngModel)]="customerEmail"
            name="customerEmail"
            placeholder="Nháº­p Ä‘á»‹a chá»‰ email...">
        </div>
        
        <!-- Row 4: Äá»‹a chá»‰ -->
        <div class="form-field full-width">
          <label>Äá»‹a chá»‰</label>
          <textarea 
            [(ngModel)]="customerAddress"
            name="customerAddress"
            placeholder="Nháº­p Ä‘á»‹a chá»‰ Ä‘áº§y Ä‘á»§..."></textarea>
        </div>
        
      </form>
    </div>
    
    <!-- Modal Footer -->
    <div class="modal-footer">
      <button class="modal-btn cancel" (click)="closeCustomerModal()">
        Há»§y
      </button>
      <button class="modal-btn save" (click)="saveCustomerInfo()">
        ğŸ’¾ LÆ°u thÃ´ng tin
      </button>
    </div>
    
  </div>
</div>